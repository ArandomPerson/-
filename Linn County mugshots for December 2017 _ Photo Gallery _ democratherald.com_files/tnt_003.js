window.__tnt||(window.__tnt={});__tnt.comment||(__tnt.comment={});__tnt.comment.post={clear:function(t){t.find("button,textarea").removeAttr("disabled");t.find("button[type=submit]").button("reset");t.find(".form-body").find("#comment-reply-preview").remove();t.find("input[name=parent_uuid]").remove();t.find("textarea[name=comment]").val("");t.find(".alert").text("").hide()},prepare:function(t,e){if(e!=""){var n=$("#comment-"+e).clone();n.attr("id","comment-reply-preview");n.find(".comment-options").remove();n.find(".comment-footer").remove();n.find(".replies").remove();n.append("<hr/>");t.find(".modal-body").prepend(n);t.append('<input type="hidden" name="parent_uuid" value="'+e+'"/>')}},data:function(t){var e=t.find("input[name=app]").val();var n=t.find("input[name=id]").val();var a="";var o="";if(t.find("textarea[name=comment]").val()!=""){o=t.find("textarea[name=comment]").val()}if(t.find("input[name=parent_uuid]").length){a=t.find("input[name=parent_uuid]").val()}this.obj=new Object({id:n,app:e,comment:o,parent_uuid:a});if(__tnt.user.authToken==null){if(t.find("input[name=alias]")){this.obj.alias=t.find("input[name=alias]").val()}if(t.find("input[name=tncms_captcha_id]")){this.obj.tncms_captcha_id=t.find("input[name=tncms_captcha_id]").val();this.obj.tncms_captcha_response=t.find("input[name=tncms_captcha_response]").val()}if(t.find("textarea.g-recaptcha-response")){this.obj["g-recaptcha-response"]=t.find("textarea.g-recaptcha-response").val()}}return this.obj}};__tnt.comment.abuse={prepare:function(t,e){t.find(".modal-body").html("");var n=$("#comment-"+e).clone();n.attr("id","comment-report-preview");n.find(".comment-options").remove();n.find(".comment-footer").remove();n.find(".replies").remove();t.find(".modal-body").prepend(n);t.find("input[name=comment_id]").val(e)}};__tnt.comment.subscribe={prepare:function(t){try{if(window.localStorage){if(localStorage.getItem("comment-subscribed-"+$("#asset-content").attr("data-asset-uuid"))){__tnt.comment.subscribe.toggle()}}}catch(e){}},toggle:function(){var t=$("#commentSubscribe");if(t.length){var e=t.attr("action");var n=["/subscribe/","/unsubscribe/"];if(e.search(/\/subscribe\//)<0){n.reverse()}t.attr("action",$("#commentSubscribe").attr("action").replace(n[0],n[1]));$("#commentSubscribeModal").find(".subscribe, .unsubscribe").toggle();$("#comments").find(".watch span").toggle()}},set:function(){var t=$("#asset-content").attr("data-asset-uuid");try{if(window.localStorage){localStorage.setItem("comment-subscribed-"+t,1)}}catch(e){}},unset:function(){var t=$("#asset-content").attr("data-asset-uuid");try{if(window.localStorage){localStorage.removeItem("comment-subscribed-"+t)}}catch(e){}}};__tnt.comment.preview={append:function(t,e){if(t.length){$.each(t,function(){__tnt.comment.preview.create(this.data,$("#commentPostModal").find(".template.success"),e)})}},create:function(t,e,n){var a=n.hasClass("desc");var o=__tnt.comment.preview.sanitize(t.comment);if(t.parent_uuid!=""){var i=$("#comment-"+t.parent_uuid);if(!i.find(".replies").length){i.append('<div class="replies"></div>')}n=i.find(".replies").first()}var m=[{element:"img.avatar",attr:[{attr:"src",value:__tnt.user.avatar}]},{element:".comment-text",html:"<p>"+o+"</p>"}];if(__tnt.user.authToken!=null){m.push({element:".username",html:__tnt.user.screenName})}else{if(t.alias!=""){m.push({element:".username",html:t.alias})}}__tnt.template(e,n,a,m,function(t){if(__tnt.user.avatar!=null){$(t).find("div.avatar").remove()}else{$(t).find("img.avatar").remove();if(__tnt.user.authToken==null){$(t).find("div.avatar").find("i").removeClass("fa-user").addClass("fa-user-secret")}}});__tnt.emoticon.handle($(".comment.preview .comment-text"))},sanitize:function(t){if(typeof t=="string"){t=t.replace(/<?\/?script[\w\W\s=" :\']*?>/g,"")}return t},store:function(t,e){var n=false;try{if(window.sessionStorage){var a=new Array;var o=new Date;var i="";var m=0;if(sessionStorage.getItem("comment-previews")!=null){a=JSON.parse(sessionStorage.getItem("comment-previews"))}i=o.getTime("u");m=e.find('.comment[data-user="'+__tnt.user.screenName+'"]').length+e.find(".comment.preview").length;storedJSON={c:m,t:i,data:{comment:t.comment,parent_uuid:t.parent_uuid}};a.push(storedJSON);var r=$("#asset-content").attr("data-asset-uuid");try{sessionStorage.setItem("comment-previews-"+r,JSON.stringify(a));n=true}catch(c){}}}catch(c){}return n},fetch:function(){var t=$("#asset-content").attr("data-asset-uuid");var e="comment-previews-"+t;var n=[];var a="";try{if(window.sessionStorage){a=sessionStorage.getItem(e);if(a!=null){n=JSON.parse(a)}}}catch(o){}return n},filter:function(t,e,n){var a=$("#asset-content").attr("data-asset-uuid");var o=e.find('.comment[data-user="'+__tnt.user.screenName+'"]');var i=o.length;var m=new Date;var r=[];if(typeof t!="undefined"){var t=__tnt.comment.preview.fetch()}if(typeof n=="undefined"){n=false}if(t){$.each(t,function(){var t=false;if(this.c<i){t=true}if(!t&&m.getTime("u")-this.t>48e4){t=true}if(!t){r.push(this)}})}if(n){try{sessionStorage.setItem("comment-previews-"+a,JSON.stringify(r))}catch(c){}}return r},clear:function(){var t=$("#asset-content").attr("data-asset-uuid");try{sessionStorage.setItem("comment-previews-"+t,null)}catch(e){}}};__tnt.comment.pending={fetch:function(){var t=$("#comment-index").attr("data-asset-uuid");var e="comment-changes-"+t;var n=[];var a="";try{if(window.sessionStorage){a=sessionStorage.getItem(e);if(a!=null){n=JSON.parse(a)}}}catch(o){}return n},process:function(t){if(t.length){$(".warning-changes-pending").show();$.each(t,function(){var t=$("#comment-"+this.data.comment_uuid);__tnt.comment.pending.mark(t)})}},mark:function(t){$(".warning-changes-pending").show();t.find(".comment-body").append('<span class="label label-warning">Changes pending</span>');t.siblings(".contribute-tools").find("button.edit, button.approve, button.deny").prop("disabled",true)},filter:function(t,e,n){var a=e.find(".comment");var o=a.length;var i=e.data("asset-uuid");var m=new Date;var r=[];if(typeof t!="undefined"){var t=__tnt.comment.pending.fetch()}if(typeof n=="undefined"){n=false}$.each(t,function(){var t=false;if(this.c<o){t=true}if(!t&&m.getTime("u")-this.t>48e4){t=true}if(!t){r.push(this)}});if(n){try{sessionStorage.setItem("comment-changes-"+i,JSON.stringify(r))}catch(c){}}return r},has_value:function(t,e,n){return t.hasOwnProperty(e)&&t[e]===n},store:function(t,e){var n=false;var a=0;try{if(window.sessionStorage){var o=$("#comment-index").attr("data-asset-uuid");var i=new Array;var m=new Date;var r=m.getTime("u");if(sessionStorage.getItem("comment-changes-"+o)!=null){i=JSON.parse(sessionStorage.getItem("comment-changes-"+o))}a=e.find(".comment").length;storedJSON={c:a,t:r,data:{comment_uuid:t.comment_uuid}};var c=false;for(var s=0;s<i.length;s++){if(__tnt.comment.pending.has_value(i[s].data,"comment_uuid",storedJSON.data.comment_uuid)){c=true;break}}if(c===false){i.push(storedJSON);try{sessionStorage.setItem("comment-changes-"+o,JSON.stringify(i));n=true}catch(d){}}}}catch(d){}return n}};$(function(){if(__tnt.user.screenName==null||__tnt.user.authToken==null){__tnt.comment.preview.clear()}else{previews=__tnt.comment.preview.filter(__tnt.comment.preview.fetch(),$("#comment-area"),true);__tnt.comment.preview.append(previews,$("#comment-area"))}if(window.location.pathname.indexOf("users/admin/business/comment")>-1&&__tnt.user.screenName!=null){changes_pending=__tnt.comment.pending.filter(__tnt.comment.pending.fetch(),$("#comment-index"),true);__tnt.comment.pending.process(changes_pending)}__tnt.emoticon.handle($(".comment .comment-text"));$("#commentPost, #commentEdit").find(".comment-emoticons-selector").on("click",function(t){t.preventDefault()});__tnt.emoticon.handle($("#commentPost, #commentEdit").find(".emoticon-selector li a"));$("#commentPost, #commentEdit").find(".emoticon-selector li a").on("click",function(t){t.preventDefault();var e=$(this).attr("title");var n=$("#commentPost, #commentEdit").find("textarea");n.val(n.val()+e)});$("a.comment-post").on("click",function(t){t.preventDefault();__tnt.comment.post.clear($("#commentPost"));var e="";if(typeof $(this).attr("data-comment-id")!="undefined"){e=$(this).attr("data-comment-id")}__tnt.comment.post.prepare($("#commentPost"),e);$("#commentPostModal").modal({backdrop:"static",keyboard:true,show:true,remove:false})});$("#commentPost").on("submit",function(t){t.preventDefault();$("#commentPostModal").find("button,textarea").attr("disabled","");$("#commentPostModal").find("button[type=submit]").button("loading");var e=__tnt.comment.post.data($("#commentPost"));if(e.comment!=""){$.ajax({type:"POST",url:$("#commentPost").attr("action"),data:e,success:function(t,e,n){if(t.success){__tnt.trackEvent({network:"Site",socialAction:"comment",url:window.location.href.split("?")[0]});$("#commentPostModal").modal("hide");$("#commentPostModal").find("button,textarea").removeAttr("disabled");var t=__tnt.comment.post.data($("#commentPost"));__tnt.comment.preview.store(t,$("#comment-area"));__tnt.comment.preview.create(t,$("#commentPost").find(".template.success"),$("#comment-area"));__tnt.comment.post.clear($("#commentPost"))}else{$("#commentPostModal").find(".alert.alert-info").text(t.error).show();$("#commentPostModal").find("button,textarea").removeAttr("disabled");$("#commentPostModal").find("button[type=submit]").button("reset");$("#commentPostModal").modal("show")}if(__tnt.user.authToken==null){$("#commentPostModal").find(".tncms-captcha-image").trigger("click");$("#commentPostModal").find("input[name=tncms_captcha_response]").val("")}}})}});$("#comments").find(".report").on("click",function(t){t.preventDefault();__tnt.comment.abuse.prepare($("#commentReport"),$(this).attr("data-comment-id"));$("#commentReportModal").modal({backdrop:"static",keyboard:true,show:true,remove:false})});$("#comments").find(".watch").on("click",function(t){t.preventDefault();$("#commentSubscribeModal").modal({backdrop:"static",keyboard:true,show:true,remove:false})});__tnt.comment.subscribe.prepare();jQuery("#commentSubscribe").bind("submit",function(t){t.preventDefault();$("#commentSubscribeModal").modal("hide");$.post($("#commentSubscribe").attr("action"),{id:$("#commentSubscribe").find("input[name=id]").val(),app:$("#commentSubscribe").find("input[name=app]").val()}).done(function(){try{if(window.localStorage){if(localStorage.getItem("comment-subscribed-"+$("#asset-content").attr("data-asset-uuid"))){__tnt.comment.subscribe.unset()}else{__tnt.comment.subscribe.set()}}}catch(t){}__tnt.comment.subscribe.toggle()}).fail(function(){})});$("#comments").find(".comment-options").on("click",function(t){t.preventDefault()});$("#commentReport").submit(function(t){t.preventDefault();$("#commentReportModal").find("button").attr("disabled","");$("#commentReportModal").find("button[type=submit]").button("loading");var e=$(this);var n=e.find("input[name=comment_id]").val();if(n!=""){$.post(e.attr("action"),{action:"comments:abuse",comment_id:n}).done(function(){$("#commentReportModal").modal("hide");$("#commentReportModal").find("button[type=submit]").button("reset");e.find("input[name=comment_id]").val("");__tnt.template($("#commentReport").find(".template.success"),$("#comment-"+n),true);$("#comment-"+n).find(".comment-heading").first().hide();$("#comment-"+n).find(".comment-body").first().hide()}).fail(function(){__tnt.template($("#commentReport").find(".template.fail"),$("#commentReport"),true)})}});$("button.comment-edit").on("click",function(t){var e=$(this).parents(".contribute-tools").siblings(".comment");var n=e.find(".comment-text p").html();$('#commentEditModal form textarea[name="content"]').val(n.replace(/<br>/g,"\n"));$('#commentEditModal form input[name="commentid"]').val(e.data("comment-uuid"));$("#commentEditModal").modal({backdrop:"static",keyboard:true,show:true,remove:false})});$("#commentEdit").on("submit",function(t){t.preventDefault();var e=$("#commentEdit").serialize();$("#commentEditModal").find("button,textarea").prop("disabled",true);$("#commentEditModal").find("button[type=submit]").button("loading");if(e.content!=""){$.ajax({type:"POST",url:$("#commentEdit").attr("action"),data:e,success:function(t,e,n){$("#commentEditModal").modal("hide");$("#commentEditModal").find("button,textarea").prop("disabled",false);var a=$("#commentEdit").find('input[name="commentid"]').val();__tnt.comment.pending.store({comment_uuid:a},$("#comment-index"));__tnt.comment.pending.mark($("#comment-"+a))}})}});$("#comment-index .contribute-tools .approve").click(function(t){var e=$(this);var n=e.parents(".contribute-tools").siblings(".comment").data("comment-uuid");var a=$("#comment-index").data("asset-uuid");$.ajax({type:"POST",url:location.href,data:{submit:"approve",commentid:n,assetid:a},success:function(t){__tnt.comment.pending.store({comment_uuid:n},$("#comment-index"));__tnt.comment.pending.mark($("#comment-"+n))}})});$("#comment-index .contribute-tools a.deny").click(function(t){var e=$(this);var n=e.parents(".contribute-tools").siblings(".comment").data("comment-uuid");var a=$("#comment-index").data("asset-uuid");var o=e.data("reason");$.ajax({type:"POST",url:location.href,data:{submit:"deny",commentid:n,assetid:a,reason:o},success:function(t){__tnt.comment.pending.store({comment_uuid:n},$("#comment-index"));__tnt.comment.pending.mark($("#comment-"+n))}})})});
//# sourceMappingURL=/tmp/git2rpm-tncms-templates-flex-dd3063b6-f9a2-4f97-ab09-b76e63c4c9d4/usr/local/share/content/art/tncms/templates/libraries/flex/components/comments/resources/scripts/tnt.comment.0fcadf320e46b9f4bd138a51d0805381.js.map